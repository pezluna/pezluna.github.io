---
layout: post
title: 파일 시스템 구조 (2)
url : test
---

# FAT
FAT은 File Allocation Table의 약자로, 비록 현대 PC에서는 사용이 거의 되지 않으나 비교적 간단한 구조를 갖기에 휴대용 저장매체 등에서 사용되어지는 파일 시스템 계열이다. 대표적으로 FAT12, FAT16, FAT32가 있다.

## FAT16
FAT16은 FAT32의 이전에 나온 방식으로, 그 구조가 FAT32와 거의 비슷하나 더욱 단순하기에 먼저 이를 짚고 넘어가도록 하겠다.

## Reserved Area(BR)
Reserved Area, 즉 에약된 영역은 파티션의 가장 앞에 위치해있는 구역이다. 1섹터의 크기를 가지며, BR이 여기에 위치해있다.  
BR은 Boot Record의 약자로, 앞에 Volume을 붙여 VBR이라고도 불린다. BR은 각 파티션의 맨 앞에 적혀있으며, 그 중 가장 앞의 1섹터는 부트섹터라고 불린다. 부트섹터는 부팅에 필요한 정보와 더불어, 파티션에 대한 자세한 정보들도 기록되어있는 중요한 구역이다.

## BR의 구조
BR의 첫 3바이트는 점프 코드로, 부팅을 하기 위한 분기를 처리해주는 역할을 한다. 각 파일 시스템에 따라 약간씩 차이가 있는데, 이에 대한 설명은 아직 필요가 없기에 넘어가도록 한다.
그 뒤에 나오는 59바이트는 OEM ID와 BPB로, 파티션에 대한 정보들이 기록되어있다. 아래의 표는 FAT16의 BPB이다.

|size|Name|Desc|
|:--:|:--:|--|
|8바이트|OEM ID|무시해도 좋음|
|2바이트|Byte per sector|섹터당 바이트|
|1바이트|Sectors per cluster|클러스터당 섹터|
|2바이트|Reserved sector count|FAT Area 앞에 있는 예약된 영역의 섹터수|
|1바이트|Number of FAT|FAT Area의 수|
|2바이트|Root directory entry count|할당된 루트 디렉토리 엔트리 개수|
|2바이트|Total sector 16|볼륨 상의 총 섹터수|
|1바이트|Media Type|볼륨에 저장된 미디어의 종류|
|2바이트|FAT size 16|FAT Area의 섹터수|
|2바이트|Sector per track|트랙당 섹터수|
|2바이트|Number of heads|헤더수|
|4바이트|Hidden sectors|볼륨 앞에 숨겨진 섹터수|
|4바이트|Total sector32|볼륨 상의 총 섹터수|
|1바이트|INT 0x13 drive number|x86에서의 INT 0x13을 위한 필드|
|1바이트|Reserved|사용하지 않는 예약된 영역|
|1바이트|Boot signature|확장 부트 서명|
|4바이트|Volume serial number|해당 볼륨의 고유 시리얼 번호|
|11바이트|Volume label|윈도우에서의 볼륨 레이블|
|8바이트|File system type|파일 시스템 방식|

이 후로 447바이트의 길이의 부트코드 에러 메시지가 적혀있고, 마지막으로 0x55AA의 시그니쳐가 들어가게된다.

## FAT Area
Reserved Area가 끝이 나면 FAT Area가 시작된다. FAT Area의 시작 위치는 Reserved sector count 필드를 참고하면 된다.  
FAT 영역은 크게 두개로 구분되는데, 실제 FAT 영역과 그의 백업 영역으로 나뉜다. FAT 영역은 파일들의 클러스터의 정보가 들어있는 아주 중요한 영역이기에 백업이 존재한다.  
FAT 영역은 2개의 예약 엔트리와 클러스터 테이블로 구성되어진다. 예약된 엔트리는 4바이트의 길이로, 실제 데이터 분석에 큰 영향을 주지 않기에 넘어가도록 한다.  

### 클러스터 테이블
클러스터 테이블은 FAT 영역 뒤편의 데이터 영역의 정보를 나타내는 역할을 한다. 해당 부분이 손상될 경우, 파일이 정상적으로 읽어질 수 없기에 각별히 유의해야한다.  
클러스터 테이블은 한 클러스터당 4바이트의 크기를 가지며, 아래의 내용을 참고하면 대략적인 데이터의 상태를 유추할 수 있다.
* 0x0000 : 빈 공간
* 0x0001 : 예약된 클러스터
* 0x0002 ~ 0xFFEF : 해당 파일의 다음 클러스트의 위치를 가리킴
* 0xFFF0 ~ 0xFFF6 : 예약된 값
* 0xFFF7 : 배드 클러스터
* 0xFFF8 ~ 0xFFFF : 파일이 할당된 클러스터

## Data Area
데이터 영역은 말 그대로 데이터들이 저장되어진 공간으로, 빠른 작업을 위해 섹터 단위가 아닌 클러스터 단위로 구성되어있다. 데이터 영역의 최상단에는 루트 디렉토리에 대한 정보가 담겨있고, 하위 디렉토리 및 파일들에 대한 내용들은 디렉토리 엔트리의 형태로, 트리구조로 저장되어있다.
데이터 영역의 위치는 FAT 영역의 바로 다음 섹터에 위치해있으며, 해당 파티션의 마지막 부분까지 데이터 영역이라고 볼 수 있다.

### 디렉토리 엔트리
디렉토리 엔트리는 하나의 구조체로, FAT16 파티션에 저장된 파일 및 디렉토리에 대한 메타데이터를 나타내는 역할을 한다. 총 32바이트 길이를 가지며, 파일(디렉토리)의 이름, 생성 및 수정된 시각에 대한 정보 등을 포함한다.  
그 중 하위 4바이트는 파일의 크기를 나타내며, 그 바로 앞의 2바이트는 할당된 클러스터의 위치를 나타낸다.

***
참고 자료 : https://blog.naver.com/s2kiess  
참고 자료 : https://blog.forensicresearch.kr/
